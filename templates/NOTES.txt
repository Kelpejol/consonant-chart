{{/*
NOTES.txt - Post-Installation Instructions
===========================================
Displayed after successful installation
Provides verification steps and next actions
*/}}

{{- $fullName := include "consonant-relayer.fullname" . -}}
{{- $namespace := include "consonant-relayer.namespace" . -}}
{{- $serviceName := $fullName -}}

âœ… Consonant Relayer installed successfully!

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“‹ INSTALLATION SUMMARY
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Release:          {{ .Release.Name }}
Namespace:        {{ $namespace }}
Chart:            {{ .Chart.Name }}-{{ .Chart.Version }}
App Version:      {{ .Chart.AppVersion }}

Cluster:          {{ .Values.cluster.name }}
{{- if .Values.cluster.region }}
Region:           {{ .Values.cluster.region }}
{{- end }}
{{- if .Values.cluster.environment }}
Environment:      {{ .Values.cluster.environment }}
{{- end }}

Backend:          {{ .Values.backend.url }}
Cloudflare:       {{ if .Values.cloudflare.enabled }}âœ“ Enabled{{ else }}âœ— Disabled{{ end }}
KAgent:           {{ if .Values.kagent.enabled }}âœ“ Installed{{ else }}âœ— Skipped{{ end }}
Network Policy:   {{ if .Values.networkPolicy.enabled }}âœ“ Enabled{{ else }}âœ— Disabled{{ end }}
External Secrets: {{ if and (eq .Values.secrets.mode "external") .Values.secrets.external.enabled }}âœ“ Enabled{{ else }}âœ— Disabled{{ end }}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ” VERIFY INSTALLATION
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1. Check pod status:
   kubectl get pods -n {{ $namespace }} -l app.kubernetes.io/instance={{ .Release.Name }}

2. Watch pods until ready:
   kubectl get pods -n {{ $namespace }} -w

3. Check logs:
   # Relayer logs
   kubectl logs -n {{ $namespace }} -l app.kubernetes.io/name={{ include "consonant-relayer.name" . }},app.kubernetes.io/component=relayer -f

   {{- if .Values.cloudflare.enabled }}
   # Cloudflared logs
   kubectl logs -n {{ $namespace }} -l app.kubernetes.io/name={{ include "consonant-relayer.name" . }},app.kubernetes.io/component=relayer -c cloudflared -f
   {{- end }}

   {{- if .Values.kagent.enabled }}
   # KAgent logs
   kubectl logs -n {{ $namespace }} -l app.kubernetes.io/name=kagent -f
   {{- end }}

4. Check pre-install hooks:
   # Registration hook
   kubectl get job -n {{ $namespace }} {{ $fullName }}-register
   kubectl logs -n {{ $namespace }} job/{{ $fullName }}-register

   {{- if .Values.kagent.enabled }}
   # KAgent cleanup hook
   kubectl get job -n {{ $namespace }} {{ $fullName }}-kagent-cleanup
   kubectl logs -n {{ $namespace }} job/{{ $fullName }}-kagent-cleanup
   {{- end }}

5. Verify cluster credentials:
   kubectl get secret -n {{ $namespace }} {{ include "consonant-relayer.clusterSecretName" . }}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ”— CONNECTIVITY
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Backend URL:      {{ .Values.backend.url }}
{{- if .Values.cloudflare.enabled }}
Connection:       Via Cloudflare Tunnel (secure)
{{- else }}
Connection:       Direct
{{- end }}

OTEL Endpoint:    {{ include "consonant-relayer.otelEndpoint" . }}
Service DNS:      {{ $serviceName }}.{{ $namespace }}.svc.cluster.local

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ§ª TEST CONNECTION
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1. Port-forward to health endpoint:
   kubectl port-forward -n {{ $namespace }} svc/{{ $serviceName }} 8080:{{ .Values.relayer.health.port }}

2. Check health (in another terminal):
   curl http://localhost:8080/health

   Expected response:
   {
     "status": "ok",
     "socket": {
       "connected": true,
       "clusterId": "cluster_xxx"
     },
     "otel": {
       "port": {{ .Values.relayer.otel.port }},
       "ready": true
     }
   }

{{- if .Values.kagent.enabled }}

3. Create a test agent:
   kubectl apply -f - <<EOF
   apiVersion: kagent.dev/v1alpha2
   kind: Agent
   metadata:
     name: test-agent
     namespace: {{ $namespace }}
   spec:
     type: Declarative
     declarative:
       description: "Test agent for Consonant verification"
       modelRef:
         name: default-{{ include "consonant-relayer.kagentProvider" . | lower }}
   EOF

4. Check agent status:
   kubectl get agents -n {{ $namespace }} test-agent

5. View in backend UI:
   {{ .Values.backend.url }}/clusters/{{ .Values.cluster.name }}/agents
{{- end }}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âš™ï¸  CONFIGURATION
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

View current values:
  helm get values {{ .Release.Name }} -n {{ $namespace }}

Update configuration:
  helm upgrade {{ .Release.Name }} {{ .Chart.Name }} \
    --reuse-values \
    --set key=value

View all resources:
  helm get manifest {{ .Release.Name }} -n {{ $namespace }}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ”§ TROUBLESHOOTING
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

{{- if not .Values.cloudflare.enabled }}
âš ï¸  WARNING: Cloudflare tunnel is disabled
   Direct connections may not work in production
   Enable with: --set cloudflare.enabled=true
{{- end }}

{{- if eq .Values.secrets.mode "kubernetes" }}
âš ï¸  WARNING: Using Kubernetes secrets (not encrypted by default)
   Enable external secrets for production:
   --set secrets.mode=external --set secrets.external.enabled=true
{{- end }}

{{- if eq (int .Values.relayer.replicas) 1 }}
{{- if eq .Values.cluster.environment "production" }}
âš ï¸  WARNING: Single replica in production
   Enable HA with: --set relayer.replicas=3
{{- end }}
{{- end }}

If pods are not starting:
  kubectl get events -n {{ $namespace }} --sort-by='.lastTimestamp'
  kubectl describe pod -n {{ $namespace }} -l app.kubernetes.io/instance={{ .Release.Name }}

{{- if .Values.cloudflare.enabled }}
If tunnel is not connecting:
  1. Verify token: kubectl get secret {{ include "consonant-relayer.tunnelSecretName" . }} -n {{ $namespace }}
  2. Check logs: kubectl logs -n {{ $namespace }} -l app.kubernetes.io/name={{ include "consonant-relayer.name" . }} -c cloudflared
  3. Verify in Cloudflare Dashboard: Zero Trust â†’ Access â†’ Tunnels
{{- end }}

If relayer not connecting to backend:
  1. Check backend accessibility:
     kubectl run -it --rm debug --image=curlimages/curl --restart=Never -- curl -v {{ .Values.backend.url }}/health
  2. Check relayer logs for connection errors
  3. Verify cluster credentials secret exists

{{- if .Values.kagent.enabled }}
If no telemetry:
  1. Check KAgent is sending: kubectl logs -n {{ $namespace }} -l app.kubernetes.io/name=kagent
  2. Verify OTEL endpoint: kubectl get svc -n {{ $namespace }}
  3. Check NetworkPolicy allows traffic
{{- end }}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“š DOCUMENTATION
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Full Documentation:    https://docs.consonant.xyz
Installation Guide:    https://docs.consonant.xyz/installation
Troubleshooting:       https://docs.consonant.xyz/troubleshooting
Security Guide:        https://docs.consonant.xyz/security

GitHub:                https://github.com/consonant/consonant
Support:               support@consonant.xyz
Community:             https://consonant.xyz/slack

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸš€ NEXT STEPS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1. Open Consonant backend:
   {{ .Values.backend.url }}

2. Navigate to your cluster:
   Clusters â†’ {{ .Values.cluster.name }}

3. Create agents through the UI

4. Watch real-time telemetry

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Thank you for using Consonant! ğŸ‰

For support: Visit us